# HuLa 项目深度梳理与二次开发指南

这份报告旨在帮助开发者快速理解 **HuLa** 的架构和代码结构，以便进行高效的二次开发。

## 1. 项目概览

**HuLa** 是一个基于 **Tauri** 的跨平台即时通讯（IM）应用，支持 Windows, macOS, Linux, iOS 和 Android。
它采用了 **Rust** (后端/系统层) + **Vue 3** (前端/UI层) 的双层架构。

## 2. 核心技术栈

| 类别 | 技术/库 | 说明 |
| :--- | :--- | :--- |
| **构建工具** | `Vite 7` | 极速构建工具 |
| | `pnpm` | 包管理器 |
| **前端框架** | `Vue 3` | 使用组合式 API (Composition API) |
| | `TypeScript` | 强类型语言支持 |
| **UI 组件库** | `Naive UI` | 桌面端主要组件库 |
| | `Vant 4` | 移动端主要组件库 |
| **样式引擎** | `UnoCSS` | 原子化 CSS 引擎 |
| | `Sass` | CSS 预处理器 |
| **状态管理** | `Pinia` | 新一代状态管理库 (含持久化插件 `pinia-plugin-persistedstate`) |
| **核心容器** | `Tauri 2.x` | 提供跨平台 WebView 容器及系统不仅能力 |

### 其他关键依赖
*   **`three.js`**: 3D 渲染库 (可能用于特效展示)
*   **`mermaid`**: 流程图/图表渲染
*   **`video.js`** / **`xgplayer`**: 视频播放支持

## 3. 目录结构导航

项目结构清晰，二次开发主要关注 `src` (前端) 和 `src-tauri` (系统层)。

### 📂 根目录概览

*   **`src-tauri/`**: **Rust 后端代码**
    *   涉及系统底层交互（如文件读写、系统托盘、原生菜单、窗口控制）。
    *   数据库 SQL 插件配置。
    *   `tauri.conf.json` 核心配置文件。
*   **`src/`**: **前端源码** (主要工作区)
*   **`docs/`**: 项目文档
*   **`scripts/`**: 构建和辅助脚本

### 📂 src 目录详解 (前端)

| 目录/文件 | 说明 |
| :--- | :--- |
| **`main.ts`** | **入口文件** - 初始化 Vue 应用、Pinia、路由、样式等 |
| **`App.vue`** | **根组件** - 应用的顶级容器 |
| **`services/`** | **API 接口层** - 所有的 HTTP/WebSocket 请求封装应定义于此 |
| **`stores/`** | **状态管理 (Pinia)** - 用户信息、Token、聊天记录、全局设置等 |
| **`views/`** | **页面视图** - 桌面端的具体页面 (如登录、聊天主窗口) |
| **`components/`** | **公共组件** - 通用 UI 组件 (如头像、聊天气泡、按钮) |
| **`layout/`** | **布局组件** - 页面骨架 (如侧边栏、顶部导航) |
| **`mobile/`** | **移动端代码** - **重点**: 移动端专属的页面和逻辑适配独立于此目录 |
| **`router/`** | **路由配置** - 定义页面跳转规则 |
| **`styles/`** | **全局样式** - Sass 变量、UnoCSS 配置、全局重置样式 |
| **`utils/`** | **工具函数** - 时间处理、加密解密、文件转换等通用逻辑 |
| **`assets/`** | **静态资源** - 图片、字体、图标 |
| **`workers/`** | **Web Workers** - 处理繁重计算 (如大文件处理、加密) 以免阻塞 UI |

## 4. 开发与构建流程

### 🚀 启动开发环境

1.  **安装依赖**:
    ```bash
    pnpm install
    ```

2.  **启动桌面端 (支持热更新)**:
    ```bash
    pnpm tauri:dev
    # 或者简写
    pnpm td
    ```

3.  **启动移动端调试 (Android)**:
    ```bash
    pnpm tauri android dev
    ```
    *(需提前配置好 Android Studio 和各类 SDK)*

### 📦 打包发布

*   **构建桌面端安装包**:
    ```bash
    pnpm tauri:build
    ```
*   **构建移动端**:
    遵循 Tauri 移动端构建流程，最终生成 APK 或 IPA 文件。

## 5. 二次开发建议

1.  **功能开发路径**:
    *   **接口定义**: 在 `src/services` 中新增后端 API 方法。
    *   **状态处理**: 在 `src/stores` 中定义数据存储和业务 Action。
    *   **UI 实现**: 在 `src/views` (桌面) 或 `src/mobile` (移动) 中编写界面组件。

2.  **样式修改**:
    *   局部样式直接写在 Vue 组件的 `<style>` 中。
    *   全局主题或变量修改 `src/styles` 下的文件。
    *   利用 UnoCSS 的原子类快速调整布局。

3.  **多端适配**:
    *   注意区分 `src/views` (通常为主桌面端) 和 `src/mobile` (移动端)。
    *   如果是通用逻辑，尽量抽取到 `hooks` 或 `utils` 中复用。

4.  **系统能力扩展**:
    *   如果需要操作系统底层能力（如读取特定硬件序列号），需在 `src-tauri` 中编写 Rust Command，并在前端通过 `@tauri-apps/api` 调用。
